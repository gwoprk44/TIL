# 우선 순위 큐

## 정의와 성질

- 우선순위 큐란 `pop`을 진행할때 원래 큐 처럼 가장 먼저 들어간 원소가 나오는 대신 우선순위가 가장 높은 원소가 나오는 큐를 의미한다.
- 힙을 이용하여 구현한다.

### 성질
1. 원소의 추가가 `O(logN)`에 이루어진다.
2. 우선순위가 가장 높은 원소의 확인이 `O(1)`에 이루어진다.
3. 우선순위가 가장 높은 원소의 제거가 `O(1)`에 이루어진다.

## 기능과 구현

### 힙
- 이진 트리의 모양을 가지고 있는 자료구조이다.
- 최댓값 혹은 최솟값을 찾는 목적으로 사용가능하다.
- 최댓값을 찾기위해 사용하는 힙을 최대 힙, 최솟값을 찾기위해 사용하는 힙을 최소힙이라 한다.
- 최대힙에서는 부모가 자식보다 커야하고, 최소힙에선 부모가 자식보다 작아야한다. 이러한 특성 때문에 루트를 찾아가면 자연스레 최대, 최소 값을 찾을 수 있게된다.
- 힙은 높이가 낮은 곳부터, 높이가 같은 정점의 경우에는 왼쪽부터 원소를 삽입한다. 이러한 이유로 힙은 불균형이 발생하지 않고 늘 균형이 맞는 이진 트리가 된다.

### Insert
- 원소를 삽입 할 때 최소힙, 최대힙 규칙에 위배되면 규칙에 어긋나지 않을때까지 원소들의 위치를 서로 교환하여 삽입한다.
- 삽입 과정은 아무리 많은 비교를 해도 최대 높이만큼만 올라가서 자리를 바꿔주면 끝나고, 힙의 구조상 균형 트리를 유지하기 때문에 시간 복잡도는 `O(logN)`이다.

### Fetch
- 최솟값의 확인이나 최댓값의 확인은 루트에 적힌 값을 살펴보면 된다.
- 단, 주의할 점으로 최소힙에서의 최솟값 확인이나 최대힙에서의 최댓값 확인은 바로 가능하나 최소힙에서의 최댓값 확인 혹은 몇번째로 작은 값의 확인, 최대힙에서의 최솟값 확인과 몇번째로 큰 값의 확인은 불가능하다.

### Erase
- 트리 구조 상에서 마지막 위치인 값과 루트의 값을 바꿔서 루트를 안전하게 제거한다.
- 이후 힙의 성질을 만족하도록 내부적으로 위치를 바꾸는 방식으로 삭제를 구현 가능하다.

### 구현
- 힙은 각 원소를 배열로 대응시켜 간단하게 나타낼 수 있다.
- 배열로 대응시켜 나타내면 `x`번지의 왼쪽 자식, 오른쪽 자식은 각각 `2x, 2x+1`번지이다.
- `x`번지의 부모 번지는 `x/2`로 나타낼 수 있다.

```cpp
#include <bits/stdc++.h>
using namespace std;

int heap[100005];
int sz = 0; // heap에 들어있는 원소의 수

void push(int x){
    heap[sz++] = x;
    int idx = sz;
    while (idx != 1) {
        int par = idx/2;
        if(heap[par] <= heap[idx]) break;
        swap(heap[par], heap[idx]);
        idx = par;
    } 
}

int top(){
    return heap[1];
}

void pop(){
    heap[1] = heap[sz--];
    int idx = 1;
    // 왼쪽 자식의 인덱스가 size보다 크면 리프노드
    while(2*idx <= sz) {
        int lc = 2*idx, rc = 2*idx+1;
        int min_child = lc;
        if (rc <= sz && heap[rc] < heap[lc])
            min_child = rc;
        if (heap[idx] <= heap[min_child]) break;
        swap[heap[idx], heap[min_child]];
        idx = min_child;
    }
}

void test(){
  push(10); push(2); push(5); push(9); // {10, 2, 5, 9}
  cout << top() << '\n'; // 2
  pop(); // {10, 5, 9}
  pop(); // {10, 9}
  cout << top() << '\n'; // 9
  push(5); push(15); // {10, 9, 5, 15}
  cout << top() << '\n'; // 5
  pop(); // {10, 9, 15}
  cout << top() << '\n'; // 9
}

int main(){
  test();
}
```
